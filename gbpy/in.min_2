# Minimization Parameters -------------------------

variable Etol equal 1e-25
variable Ftol equal 1e-25
variable MaxIter equal 10000
variable MaxEval equal 10000

# Structural variables------------------------------

variable LatParam equal 4.05
# ------------------------------------------------

variable cnt equal 1
# ------------------------------------------------

variable OverLap equal 1.4318912319027588

# -----------Initializing the Simulation-----------

clear
units metal
dimension 3
boundary p p f
atom_style atomic
atom_modify map array

# ---------Creating the Atomistic Structure--------

lattice fcc ${LatParam}
region whole prism 0.033134277860597555 15.911731667014667 0.03906977557908387 16.460281384686887 -101.25 101.25 2.558439953091697 0.0 0.0 units box
create_box 2 whole

read_dump ./lammps_dump/output/gb_attr_Al_S7_1_N1_4_2_1_N2_-4_-1_-2/heat.0 0 x y z box yes add yes 
# -------Defining the potential functions----------

pair_style eam/alloy
pair_coeff * * ./lammps_dump/Al99.eam.alloy Al Al
neighbor 2 bin
neigh_modify delay 5 check yes
group lower type 2 
group upper type 1

# ---------Computing Simulation Parameters---------

compute csym all centro/atom fcc
compute eng all pe/atom
compute eatoms all reduce sum c_eng
compute MinAtomEnergy all reduce min c_eng


#----------------------Run minimization 1--------------------

reset_timestep 0
thermo 100
thermo_style custom step pe lx ly lz xy xz yz xlo xhi ylo yhi zlo zhi press pxx pyy pzz c_eatoms c_MinAtomEnergy
thermo_modify lost ignore
min_style cg
minimize 1e-5 1e-5 5000 10000

#----------------------Run minimization 2--------------------

thermo 100
thermo_style custom step pe lx ly lz xy xz yz xlo xhi ylo yhi zlo zhi press pxx pyy pzz c_eatoms c_MinAtomEnergy
thermo_modify lost ignore
fix 1 all box/relax x 0 y 0 xy 0 vmax .001
min_style cg
minimize ${Etol} ${Ftol} ${MaxIter} ${MaxEval}

#----------------------Run 0 to dump--------------------

reset_timestep 0
reset_ids
thermo 100
thermo_style custom step pe lx ly lz xy xz yz xlo xhi ylo yhi zlo zhi press pxx pyy pzz c_eatoms c_MinAtomEnergy
thermo_modify lost ignore
dump 1 all custom ${MaxIter} ./lammps_dump/output/gb_attr_Al_S7_1_N1_4_2_1_N2_-4_-1_-2/dump.1153 id type x y z c_csym c_eng
dump_modify 1 every ${MaxIter} sort id first yes
run 0
unfix 1
undump 1
